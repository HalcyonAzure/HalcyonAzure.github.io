---
layout: post
title: "Cloudflare Partner的CDN配置"
date: 2021-04-27 10:00:00
categories: 小技巧
tags: CDN
---

## 通过Dnspod解析域名

​    由于服务器本身搭建使用的是香港的服务器，建站不需要域名备案。为了不使用Cloudflare默认的海外CDN，而使用我们需求的自定义CDN，需要把域名托管到一个非Cloudflare的平台下，这里直接托管到腾讯云Dnspod的解析下。

1. 备份Cloudflare下的解析信息

2. 在控制台下修改Name Server为Dnspod控制台提供的NS服务器

3. 将之前备份的解析信息再次添入

   （这里没找到Dnspod的导入域名信息，所以手动添入）

4. 开启"域名设置"下的CNAME加速，减少CNAME的解析次数

## 设置CloudFlare CNAME

1. 注册Cloudflare邮箱，这里不做解释

2. 在 [楠格](https://cdn.ink/)(或者类似Cloudflare Partner网站) 登入自己的Cloudflare账号

3. 将自己需要使用CDN的域名添加到控制台下，TTL设置两分钟，CDN设置为开启

   ![域名添加](https://lsky.halc.top/hIWDDR.png)

4. 添加完毕以后在CNAME接入处可以看到主机名对应的CNAME信息，在Dnspod设置对应的解析就可以使用CDN的解析服务。

   ![域名添加](https://lsky.halc.top/C0TJFQ.png)

   <!-- markdownlint-disable MD033 -->
   <div align=center>CNAME信息 </div>

   ![Dnspod设置](https://lsky.halc.top/zI17lg.png)

   <div align=center>Dnspod设置 </div>

## 自定义CDN节点

​    通过参考网上的IP表，在Dnspod的控制台中再次添加域名对应的A记录解析，可以设置不同的运营商解析不同的IP，来达到让流量走自定义加速的目的。

```plain
172.64.32.1/24 （推荐移动，走香港）
104.28.14.0/24 （推荐移动，走新加坡）
104.23.240.0-104.23.243.254 （推荐联通、移动，线路未知）
108.162.236.1/24 （推荐联通，走美国）
104.20.157.0/24 （推荐联通，走日本）
104.16.160.1/24 （推荐电信，走洛杉矶）
172.64.0.0/24 （推荐电信，走旧金山）
172.64.32.* （走欧洲）
 
108.162.236.1/24 联通 走美国
172.64.32.1/24 移动 走香港
104.16.160.1/24 电信 走美国洛杉矶
172.64.0.0/24 电信 美国旧金山
104.20.157.0/24 联通 走日本
104.28.14.0/24 移动 走新加坡
 
104.18.62.1/24 香港hkix.net
104.16.35.1/24 香港hkix.net
104.16.36.1/24 香港hkix.net
104.18.35.1/24 香港hkix.net
104.18.36.1/24 香港hkix.net
104.16.54.1/24 香港
104.16.55.1/24 香港
104.18.128.1/24 香港
104.18.129.1/24 香港
104.18.130.1/24 香港
104.18.131.1/24 香港
104.18.132.1/24 香港
104.19.195.1/24 香港
104.19.196.1/24 香港
104.19.197.1/24 香港
104.19.198.1/24 香港
104.19.199.1/24 香港
#适合电信的节点
104.23.240.*
#走欧洲各国出口 英国德国荷兰等 延迟比美国高一些 适合源站在欧洲的网站
172.64.32.*
#虽然去程走新加坡，但是回程线路的绕路的，实际效果不好，不推荐
104.16.160.*
#圣何塞的线路，比洛杉矶要快一点，推荐
108.162.236.*
#亚特兰大线路，延迟稳定，但是延迟较高
#适合移动的节点
162.158.133.* 
#走的丹麦，这一段ip只有部分能用，可以自己试一下，绕美国
198.41.214.*
198.41.212.*
198.41.208.*
198.41.209.*
172.64.32.*
141.101.115.*
#移动走香港的IP段有很多，以上并不是全部。CF移动走香港的分直连和走ntt的效果都挺不错的，不过部分地区晚上还是会丢包。
172.64.0. *
#这是走圣何塞的，一般用香港的就行
172.64.16.* 
#欧洲线路.绕
#1.0.0.1效果较好
电信部分
大多数省直接使用1.0.0.0即可，延迟低，丢包少，
## 移动部分
#新加坡
104.18.48.0-104.18.63.255
104.24.112.0-104.24.127.255
104.27.128.0-104.27.143.255
104.28.0.0-104.28.15.255
## 移动部分
#圣何塞 
104.28.16.0-31.255
104.27.144.0-243.254
104.23.240.0-243.254
#香港cloudflare1-100g.hkix.net
1.0.0.0-254
1.1.1.0-254
#香港直连
104.16.0.0-79.255
104.16.96.0-175.254
104.16.192.0-207.255
```

设置了对应的A记录后保存退出，可通过`ping example.com`来测试是否设置成功。

参考网站:

1. [针对使用Cloudflare CDN国内网站的速度优化方案 - 闪电博 (wbolt.com)](https://www.wbolt.com/optimization-for-cn-websites-using-cloudflare.html)
