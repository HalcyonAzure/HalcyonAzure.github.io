<!DOCTYPE html><html lang="zh-CN" data-default-color-scheme="auto"><head><meta charset="UTF-8"><link rel="apple-touch-icon" sizes="76x76" href="/img/favicon-pic.png"><link rel="icon" href="/img/favicon-pic.png"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=5,shrink-to-fit=no"><meta http-equiv="x-ua-compatible" content="ie=edge"><meta name="theme-color" content="#2f4154"><meta name="author" content="HalcyonAzure"><meta name="keywords" content=""><meta name="description" content="学习记录 这个博客主要记录了自己尝试通过抓包分析并解决一些问题的心路历程，从结果上来说很可能问题并没有解决，但是尝试解决这个问题的过程中遇到的一些问题以及自己的思考想通过写博客的方式先记录下来，在以后自己知识储备扩充的时候也许就可以回过头来看看解决下。  第一次抓包  遇到的问题 今天在尝试部署zerotier的zeronsd私有DNS服务的时候遇到了一个问题：无论是在我之前国内的服务器A上还是"><meta property="og:type" content="article"><meta property="og:title" content="网络抓包记录"><meta property="og:url" content="https://halc.top/p/3930e42b"><meta property="og:site_name" content="Halcyon Zone"><meta property="og:description" content="学习记录 这个博客主要记录了自己尝试通过抓包分析并解决一些问题的心路历程，从结果上来说很可能问题并没有解决，但是尝试解决这个问题的过程中遇到的一些问题以及自己的思考想通过写博客的方式先记录下来，在以后自己知识储备扩充的时候也许就可以回过头来看看解决下。  第一次抓包  遇到的问题 今天在尝试部署zerotier的zeronsd私有DNS服务的时候遇到了一个问题：无论是在我之前国内的服务器A上还是"><meta property="og:locale" content="zh_CN"><meta property="og:image" content="https://lsky.halc.top/wEbLzt.png"><meta property="og:image" content="https://lsky.halc.top/kIq3eR.png"><meta property="og:image" content="https://lsky.halc.top/Fm7IOM.png"><meta property="og:image" content="https://lsky.halc.top/3bRIeE.png"><meta property="og:image" content="https://lsky.halc.top/DKeJLu.png"><meta property="og:image" content="https://lsky.halc.top/5fRpjw.png"><meta property="og:image" content="https://lsky.halc.top/2nYkkM.png"><meta property="og:image" content="https://lsky.halc.top/DzjxGf.png"><meta property="og:image" content="https://lsky.halc.top/oq3GCR.png"><meta property="og:image" content="https://lsky.halc.top/BOOb7K.png"><meta property="article:published_time" content="2023-07-26T18:18:40.000Z"><meta property="article:modified_time" content="2023-08-03T11:21:12.000Z"><meta property="article:author" content="HalcyonAzure"><meta property="article:tag" content="Wireshark"><meta name="twitter:card" content="summary_large_image"><meta name="twitter:image" content="https://lsky.halc.top/wEbLzt.png"><meta name="referrer" content="no-referrer-when-downgrade"><script async src="https://umami.azsyc.com/script.js" data-website-id="ab8bb282-3900-4ec9-a4dd-6076b4af581c"></script><title>网络抓包记录 - Halcyon Zone</title><link rel="stylesheet" href="https://lib.baomitu.com/twitter-bootstrap/4.6.1/css/bootstrap.min.css"><link rel="stylesheet" href="https://lib.baomitu.com/github-markdown-css/4.0.0/github-markdown.min.css"><link rel="stylesheet" href="https://lib.baomitu.com/hint.css/2.7.0/hint.min.css"><link rel="stylesheet" href="https://lib.baomitu.com/fancybox/3.5.7/jquery.fancybox.min.css"><link rel="stylesheet" href="//at.alicdn.com/t/c/font_1749284_5i9bdhy70f8.css"><link rel="stylesheet" href="//at.alicdn.com/t/font_1736178_lbnruvf0jn.css"><link rel="stylesheet" href="/css/main.css"><link id="highlight-css" rel="stylesheet" href="/css/highlight.css"><link id="highlight-css-dark" rel="stylesheet" href="/css/highlight-dark.css"><link rel="stylesheet" href="/css/round.css"><script id="fluid-configs">var Fluid=window.Fluid||{};Fluid.ctx=Object.assign({},Fluid.ctx);var CONFIG={hostname:"halc.top",root:"/",version:"1.9.8",typing:{enable:!0,typeSpeed:70,cursorChar:"_",loop:!1,scope:[]},anchorjs:{enable:!0,element:"h1,h2,h3,h4,h5,h6",placement:"right",visible:"hover",icon:""},progressbar:{enable:!0,height_px:3,color:"#29d",options:{showSpinner:!1,trickleSpeed:100}},code_language:{enable:!0,default:"TEXT"},copy_btn:!0,image_caption:{enable:!0},image_zoom:{enable:!0,img_url_replace:["",""]},toc:{enable:!0,placement:"right",headingSelector:"h1,h2,h3,h4,h5,h6",collapseDepth:0},lazyload:{enable:!0,loading_img:"/img/loading.gif",onlypost:!1,offset_factor:2},web_analytics:{enable:!0,follow_dnt:!0,baidu:"c4f509f89fec4843f255dfb1ae66ca2b",google:null,tencent:{sid:null,cid:null},leancloud:{app_id:null,app_key:null,server_url:null,path:"window.location.pathname",ignore_local:!0},umami:{src:null,website_id:null,domains:null,start_time:"2024-01-01T00:00:00.000Z",token:null,api_server:null},gtag:null,woyaola:null,cnzz:null},search_path:"/local-search.xml",include_content_in_search:!0};if(CONFIG.web_analytics.follow_dnt){var dntVal=navigator.doNotTrack||window.doNotTrack||navigator.msDoNotTrack;Fluid.ctx.dnt=dntVal&&(dntVal.startsWith("1")||dntVal.startsWith("yes")||dntVal.startsWith("on"))}</script><script src="/js/utils.js"></script><script src="/js/color-schema.js"></script><script async>if(!Fluid.ctx.dnt){var _hmt=_hmt||[];!function(){var e=document.createElement("script");e.src="https://hm.baidu.com/hm.js?c4f509f89fec4843f255dfb1ae66ca2b";var t=document.getElementsByTagName("script")[0];t.parentNode.insertBefore(e,t)}()}</script><meta name="generator" content="Hexo 7.3.0"><link rel="alternate" href="/atom.xml" title="Halcyon Zone" type="application/atom+xml">
</head><body><header><div class="header-inner" style="height:70vh"><nav id="navbar" class="navbar fixed-top navbar-expand-lg navbar-dark scrolling-navbar"><div class="container"><a class="navbar-brand" href="/"><strong>Halcyon</strong> </a><button id="navbar-toggler-btn" class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation"><div class="animated-icon"><span></span><span></span><span></span></div></button><div class="collapse navbar-collapse" id="navbarSupportedContent"><ul class="navbar-nav ml-auto text-center"><li class="nav-item"><a class="nav-link" href="/" target="_self"><i class="iconfont icon-home-fill"></i> <span>首页</span></a></li><li class="nav-item"><a class="nav-link" href="/archives/" target="_self"><i class="iconfont icon-archive-fill"></i> <span>归档</span></a></li><li class="nav-item"><a class="nav-link" href="/categories/" target="_self"><i class="iconfont icon-category-fill"></i> <span>分类</span></a></li><li class="nav-item"><a class="nav-link" href="/tags/" target="_self"><i class="iconfont icon-tags-fill"></i> <span>标签</span></a></li><li class="nav-item"><a class="nav-link" href="/about/" target="_self"><i class="iconfont icon-user-fill"></i> <span>关于</span></a></li><li class="nav-item"><a class="nav-link" href="/links/" target="_self"><i class="iconfont icon-link-fill"></i> <span>友链</span></a></li><li class="nav-item" id="search-btn"><a class="nav-link" target="_self" href="javascript:;" data-toggle="modal" data-target="#modalSearch" aria-label="Search"><i class="iconfont icon-search"></i></a></li><li class="nav-item" id="color-toggle-btn"><a class="nav-link" target="_self" href="javascript:;" aria-label="Color Toggle"><i class="iconfont icon-dark" id="color-toggle-icon"></i></a></li></ul></div></div></nav><div id="banner" class="banner" parallax="true" style="background:url(/img/post.png) no-repeat center center;background-size:cover"><div class="full-bg-img"><div class="mask flex-center" style="background-color:rgba(0,0,0,.3)"><div class="banner-text text-center fade-in-up"><div class="h2"><span id="subtitle" data-typed-text="网络抓包记录"></span></div><div class="mt-3"><span class="post-meta"><i class="iconfont icon-date-fill" aria-hidden="true"></i> <time datetime="2023-07-27 02:18" pubdate>2023年7月27日 凌晨</time></span></div><div class="mt-1"><span class="post-meta mr-2"><i class="iconfont icon-chart"></i>2.3k 字 </span><span class="post-meta mr-2"><i class="iconfont icon-clock-fill"></i>20 分钟 </span><span id="busuanzi_container_page_pv" style="display:none"><i class="iconfont icon-eye" aria-hidden="true"></i> <span id="busuanzi_value_page_pv"></span> 次</span></div></div></div></div></div></div></header><main><div class="container-fluid nopadding-x"><div class="row nomargin-x"><div class="side-col d-none d-lg-block col-lg-2"></div><div class="col-lg-8 nopadding-x-md"><div class="container nopadding-x-md" id="board-ctn"><div id="board"><article class="post-content mx-auto"><h1 id="seo-header">网络抓包记录</h1><p id="updated-time" class="note note-info">本文最后更新于：2023年8月3日 晚上</p><div class="markdown-body"><h1 id="学习记录"><a class="markdownIt-Anchor" href="#学习记录"></a> 学习记录</h1><p>这个博客主要记录了自己尝试通过抓包分析并解决一些问题的心路历程，从结果上来说很可能问题并没有解决，但是尝试解决这个问题的过程中遇到的一些问题以及自己的思考想通过写博客的方式先记录下来，在以后自己知识储备扩充的时候也许就可以回过头来看看解决下。</p><h1 id="第一次抓包"><a class="markdownIt-Anchor" href="#第一次抓包"></a> 第一次抓包</h1><h2 id="遇到的问题"><a class="markdownIt-Anchor" href="#遇到的问题"></a> 遇到的问题</h2><p>今天在尝试部署<code>zerotier</code>的<code>zeronsd</code>私有<code>DNS</code>服务的时候遇到了一个问题：无论是在我之前国内的服务器A上还是香港的服务器B上，<code>zeronsd</code>的部署都是只需要无脑复制粘贴指令就能成功，但是今天尝试在新租赁的国内服务器C上部署的时候则遇到了一个报错：<code>Error Response</code></p><p><img src="https://lsky.halc.top/wEbLzt.png" srcset="/img/loading.gif" lazyload alt="不明所以的报错"></p><p>在翻阅<code>zeronsd</code>源码的时候发现这块逻辑本来应该是对应请求<code>zerotier</code>那边获取到局域网内所有设备的<code>IP</code>以便于创建私有的<code>DNS</code>条目。</p><p><img src="https://lsky.halc.top/kIq3eR.png" srcset="/img/loading.gif" lazyload alt="zeronsd源码"></p><p>可以看见这部分错误处理里面并没有<code>Error Response</code>的产生原因，而且同时我在香港的服务器上依旧可以正常使用<code>zeronsd</code>。因此也产生了想尝试通过抓包找到问题所在的想法。</p><h2 id="解决过程"><a class="markdownIt-Anchor" href="#解决过程"></a> 解决过程</h2><h3 id="通过lsof获取目标ip"><a class="markdownIt-Anchor" href="#通过lsof获取目标ip"></a> 通过<code>lsof</code>获取目标IP</h3><p>既然知道了问题是来自于<code>zeronsd</code>，而且应该是一个和网络<code>Response</code>有关系的问题，那么通过抓包应该是最通用的排查方法。在这里首先通过<code>lsof</code>工具查询<code>zeronsd</code>打开的连接</p><blockquote><p>最开始找到的指令是先通过<code>pidof zeronsd</code>找到进程的<code>pid</code>，然后通过<code>pid</code>来用<code>lsof</code>查询，指令大概是<code>lsof -p $(pidof zeronsd)</code>，结果后面翻了下<code>lsof</code>的手册，发现可以直接用<code>-c</code>来找进程，不过<code>pidof</code>以后也感觉会用到，姑且做个记录。</p></blockquote><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><code class="hljs shell">[root@Aliyun:~]<br><span class="hljs-meta prompt_"># </span><span class="language-bash">lsof -c zeronsd</span><br>COMMAND   PID USER   FD      TYPE             DEVICE SIZE/OFF   NODE NAME<br>zeronsd 18437 root  cwd       DIR              254,1     4096      2 /<br>zeronsd 18437 root  rtd       DIR              254,1     4096      2 /<br>zeronsd 18437 root  txt       REG              254,1  8752136 804251 /usr/bin/zeronsd<br>zeronsd 18437 root  mem       REG              254,1    93000 787112 /usr/lib/x86_64-linux-gnu/libresolv-2.31.so<br>zeronsd 18437 root  mem       REG              254,1    26952 787106 /usr/lib/x86_64-linux-gnu/libnss_dns-2.31.so<br>zeronsd 18437 root  mem       REG              254,1    51696 787107 /usr/lib/x86_64-linux-gnu/libnss_files-2.31.so<br>zeronsd 18437 root  mem       REG              254,1  1901536 786465 /usr/lib/x86_64-linux-gnu/libc-2.31.so<br>zeronsd 18437 root  mem       REG              254,1    18688 787097 /usr/lib/x86_64-linux-gnu/libdl-2.31.so<br>zeronsd 18437 root  mem       REG              254,1  1321344 787098 /usr/lib/x86_64-linux-gnu/libm-2.31.so<br>zeronsd 18437 root  mem       REG              254,1   149520 787110 /usr/lib/x86_64-linux-gnu/libpthread-2.31.so<br>zeronsd 18437 root  mem       REG              254,1   100736 786450 /usr/lib/x86_64-linux-gnu/libgcc_s.so.1<br>zeronsd 18437 root  mem       REG              254,1  3076992 802235 /usr/lib/x86_64-linux-gnu/libcrypto.so.1.1<br>zeronsd 18437 root  mem       REG              254,1   597792 802236 /usr/lib/x86_64-linux-gnu/libssl.so.1.1<br>zeronsd 18437 root  mem       REG              254,1   177928 786460 /usr/lib/x86_64-linux-gnu/ld-2.31.so<br>zeronsd 18437 root    0r      CHR                1,3      0t0      4 /dev/null<br>zeronsd 18437 root    1u     unix 0x0000000070328a2d      0t0 105666 type=STREAM<br>zeronsd 18437 root    2u     unix 0x0000000070328a2d      0t0 105666 type=STREAM<br>zeronsd 18437 root    3u  a_inode               0,13        0   8321 [eventpoll]<br>zeronsd 18437 root    4u  a_inode               0,13        0   8321 [eventfd]<br>zeronsd 18437 root    5u  a_inode               0,13        0   8321 [eventpoll]<br>zeronsd 18437 root    6u     unix 0x000000008c202115      0t0 105669 type=STREAM<br>zeronsd 18437 root    7u     unix 0x0000000072325ef6      0t0 105670 type=STREAM<br>zeronsd 18437 root    8u     unix 0x000000008c202115      0t0 105669 type=STREAM<br>zeronsd 18437 root    9u     IPv4             104709      0t0    TCP iZf8zgk9dawv2exr28bz0oZ:57136-&gt;151.101.109.91:https (SYN_SENT)<br></code></pre></td></tr></table></figure><p>可以发现下面有创建一个<code>TCP</code>连接，并且是处于<code>SYN_SENT</code>的状态。同时在我短时间内重复输入<code>lsof</code>的指令（蠢但有效.jpg），发现返回的依旧是<code>SYN_SENT</code>。一般来说<code>SYN</code>握手的速度应该是很快的，这里很长时间内都处于<code>SYN_SENT</code>的状态就明显很不对劲，所以接下来就需要通过抓包来分析。</p><p>在我多次尝试了<code>lsof</code>之后，发现即使有的时候能让连接处于<code>ESTABLISHED</code>的状态，但是过了一会以后依旧会被掐断，并且返回<code>Error Response</code>。通过分析不同的<code>lsof</code>建立<code>TCP</code>连接的目标<code>ip</code>,发现服务器总是向<code>151.101.109.91</code>和<code>146.75.113.91</code>建立连接，应该是请求的域名有做<code>CDN</code>所以解析到了不同的<code>IP</code>。接下来知道了目标<code>IP</code>，抓包就很容易了。这里采取的是通过<code>tshark</code>在配置较弱的服务器上获取到了数据包以后再导出到本地计算机的<code>Wireshark</code>的方法进行分析。</p><h3 id="tshark抓包分析"><a class="markdownIt-Anchor" href="#tshark抓包分析"></a> <code>tshark</code>抓包分析</h3><p>首先使用下面的指令对所有<code>http</code>请求进行抓取，并将抓包的内容保存在<code>data.cap</code>文件中</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">tshark -d tcp.port==443,http -w data.cap<br></code></pre></td></tr></table></figure><p>之后再将这个文件下载到本地电脑使用<code>Wireshark</code>过滤选定目标<code>IP</code>追踪<code>TCP</code>流，可以发现数据流如下图</p><p><img src="https://lsky.halc.top/Fm7IOM.png" srcset="/img/loading.gif" lazyload alt="数据流"></p><p>可以发现就这一次的数据来说<code>SYN</code>握手的部分是成功了的，<code>TLS</code>的四次握手也能成功建立，但是在发送了一些应用数据之后，云的服务器就开始向远端服务器发送<code>RST</code>报文来请求强制终止连接了。重新抓包以后又发现出现了多次<code>TCP</code>数据包的重传。</p><p>对于在TCP连接中，先发送了<code>FIN</code>，然后发送<code>RST</code>的一个可能性的原因如下：</p><ul><li><a target="_blank" rel="noopener" href="https://serverfault.com/questions/854692/client-sends-rst-after-fin-ack">packet capture - Client sends RST after FIN,ACK - Server Fault</a></li></ul><blockquote><p>您的流中的FIN和RST数据包并不直接相关。通过发送FIN，表示没有更多要发送的数据。它仍然可以从连接的另一端接收更多数据。然而，当有更多数据到达时，发送RST来表示应用程序将不再从套接字读取任何数据。</p><p>如果一个应用程序想要干净地关闭TCP连接而不引发任何RST数据包，则必须首先使用shutdown系统调用关闭写入套接字，同时保持读取套接字处于打开状态。在关闭写入套接字之后，它仍然需要读取所有对方要发送的数据，然后才能完全关闭套接字。</p></blockquote><p>但是<code>zeronsd</code>对于这次连接的重置是返回了<code>Error</code>的，所以基本上可以判断并不是<code>zeronsd</code>本身发送的<code>rst</code>阻断连接。</p><p>在这里为了让后续抓包更容易复现，首先对于<code>TLS</code>建立握手的第一个数据包，我们可以直接查询到域名</p><img src="https://lsky.halc.top/3bRIeE.png" srcset="/img/loading.gif" lazyload alt="检查TLS握手的域名" style="zoom:50%"><p>之后我就尝试通过<code>curl -vL my.zerotier.com</code>的方法来通过抓取<code>curl</code>包分析问题。为了区分成功和失败的区别，我在这里也使用了<code>curl -vL www.baidu.com</code>作为对照组。</p><h4 id="百度请求"><a class="markdownIt-Anchor" href="#百度请求"></a> 百度请求</h4><p>返回的抓包内容大致如下：</p><p><img src="https://lsky.halc.top/DKeJLu.png" srcset="/img/loading.gif" lazyload alt="使用curl请求百度"></p><p>可以发现整个连接没有大问题，只是在连接结束以后百度那边发送了一个<code>rst</code>包给我们，但是<code>tcp</code>的四次挥手是正常完成了的。</p><h4 id="zerotier请求"><a class="markdownIt-Anchor" href="#zerotier请求"></a> Zerotier请求</h4><p><img src="https://lsky.halc.top/5fRpjw.png" srcset="/img/loading.gif" lazyload alt="使用curl请求zerotier"></p><p>可以发现在想要结束连接的时候并没有正常挥手，在客户端这边接收到服务器那边的<code>FIN</code>之前就开始给服务器发送<code>RST</code>报文尝试断开连接</p><h2 id="总述"><a class="markdownIt-Anchor" href="#总述"></a> 总述</h2><p>这次抓包本身没有获取到啥决定性的信息可以确定问题产生的原因，因此目前自己也只能借由<code>Zerotier</code>和百度请求的对比，怀疑是因为<code>Zerotier</code>是国外网站，被服务商阻断了（但是在<code>FIN</code>之后再阻断也很奇怪，虽然会在<code>FIN</code>之后发送<code>RST</code>报文，但是<code>curl</code>还是可以读取到<code>my.zerotier.com</code>的网页信息），暂时对进一步的排查没有头绪。</p><h1 id="第二次遇到问题"><a class="markdownIt-Anchor" href="#第二次遇到问题"></a> 第二次遇到问题</h1><p>我尝试在同一台服务器上部署一个<code>VOIP</code>服务器。也是一样使用别的服务器的时候一点问题都没有，但是在这台国内的服务器上就遇到问题了。这次遇到问题就想尽可能的搞懂原因，因此做了以下实验</p><h2 id="分情况尝试连接"><a class="markdownIt-Anchor" href="#分情况尝试连接"></a> 分情况尝试连接</h2><ul><li><p>实验设备：一台香港服务器（对照组），一台阿里云国内服务器（样本组），以及自己的<code>Windows</code>设备</p></li><li><p>实验情景：在香港和国内服务器上都部署<code>Mumble</code>的服务器（一个<code>VOIP</code>程序），然后使用<code>Windows</code>对这两台服务器进行连接，其中<code>Mumble</code>连接采取了<code>TLS</code>加密的方式，加密证书均为自签。</p></li><li><p>实验步骤：</p><ol><li>使用IP直连香港服务器上在端口<code>64738</code>部署的<code>murmur</code>（<code>Mumble</code>服务端的别称）</li><li>使用域名<code>voice1.abc.com</code>连接香港服务器在端口<code>64738</code>部署的<code>murmur</code></li><li>使用IP直连国内服务器上在端口<code>64738</code>部署的<code>murmur</code></li><li>使用域名<code>voice2.abc.com</code>连接国内服务器在端口<code>64738</code>部署的<code>murmur</code></li></ol></li><li><p>实验期望：四种不同的方式连接<code>murmur</code>都能成功，且不会有明显区别</p></li><li><p>实验结果：方法1-3都可以正常访问，但是方法4连接被服务器阻断</p></li></ul><h2 id="抓包分析问题"><a class="markdownIt-Anchor" href="#抓包分析问题"></a> 抓包分析问题</h2><p>在对以上四种情况进行抓包以后，获取到的<code>Wireshark</code>图像大致如下</p><ol><li><p>香港服务器使用域名连接</p><p><img src="https://lsky.halc.top/2nYkkM.png" srcset="/img/loading.gif" lazyload alt="香港 - 域名连接"></p></li><li><p>香港服务器使用IP直连</p><p><img src="https://lsky.halc.top/DzjxGf.png" srcset="/img/loading.gif" lazyload alt="香港 - IP直连"></p></li><li><p>国内服务器使用IP直连</p><p><img src="https://lsky.halc.top/oq3GCR.png" srcset="/img/loading.gif" lazyload alt="国内 - IP直连"></p></li><li><p>国内服务器使用域名连接</p><p><img src="https://lsky.halc.top/BOOb7K.png" srcset="/img/loading.gif" lazyload alt="国内 - 域名连接"></p></li></ol><p>到这里基本上很明显可以发现只有在国内服务器使用域名连接的时候，服务器那边会在进行<code>TLS</code>握手的时候直接进行阻断，让你无法成功建立<code>TLS</code>连接</p><h2 id="总述-2"><a class="markdownIt-Anchor" href="#总述-2"></a> 总述</h2><p>这次抓包也没获得啥特别有用的信息。不过由于这个问题是在用阿里云的时候才遇到，之前用同样在国内的腾讯云没有遇到，则初步怀疑是阿里云对任意端口（非443）现在都做了备案检测，只要是没备案的域名/网站，无论是<code>TLS</code>还是明文，只要检测到你用了域名就禁封。相比之下腾讯那边就要宽松一些，至少<code>murmur</code>在腾讯云上是可以正常使用域名进行连接通讯的。</p></div><hr><div><div class="post-metas my-3"><div class="post-meta mr-3 d-flex align-items-center"><i class="iconfont icon-category"></i> <span class="category-chains"><span class="category-chain"><a href="/categories/%E5%B0%8F%E6%8A%80%E5%B7%A7/" class="category-chain-item">小技巧</a></span></span></div><div class="post-meta"><i class="iconfont icon-tags"></i> <a href="/tags/Wireshark/" class="print-no-link">#Wireshark</a></div></div><div class="license-box my-3"><div class="license-title"><div>网络抓包记录</div><div>https://halc.top/p/3930e42b</div></div><div class="license-meta"><div class="license-meta-item"><div>作者</div><div>HalcyonAzure</div></div><div class="license-meta-item license-meta-date"><div>发布于</div><div>2023年7月27日</div></div><div class="license-meta-item"><div>许可协议</div><div><a class="print-no-link" target="_blank" href="https://creativecommons.org/licenses/by/4.0/"><span class="hint--top hint--rounded" aria-label="BY - 署名"><i class="iconfont icon-cc-by"></i></span></a></div></div></div><div class="license-icon iconfont"></div></div><div class="post-prevnext my-3"><article class="post-prev col-6"><a href="/p/23c3db21" title="DNS问题排查思路"><i class="iconfont icon-arrowleft"></i> <span class="hidden-mobile">DNS问题排查思路</span> <span class="visible-mobile">上一篇</span></a></article><article class="post-next col-6"><a href="/p/83fa91fc" title="基础算法（一）"><span class="hidden-mobile">基础算法（一）</span> <span class="visible-mobile">下一篇</span> <i class="iconfont icon-arrowright"></i></a></article></div></div><article id="comments" lazyload><script type="text/javascript">Fluid.utils.loadComments("#comments",(function(){var t=document.documentElement.getAttribute("data-user-color-scheme");t="dark"===t?"github-dark":"github-light",window.UtterancesThemeLight="github-light",window.UtterancesThemeDark="github-dark";var e=document.createElement("script");e.setAttribute("src","https://utteranc.es/client.js"),e.setAttribute("repo","HalcyonAzure/HalcyonAzure.github.io"),e.setAttribute("issue-term","title"),e.setAttribute("label","blog commit"),e.setAttribute("theme",t),e.setAttribute("crossorigin","anonymous"),document.getElementById("comments").appendChild(e)}))</script><noscript>Please enable JavaScript to view the comments</noscript></article></article></div></div></div><div class="side-col d-none d-lg-block col-lg-2"><aside class="sidebar" style="margin-left:-1rem"><div id="toc"><p class="toc-header"><i class="iconfont icon-list"></i> <span>目录</span></p><div class="toc-body" id="toc-body"></div></div></aside></div></div></div><a id="scroll-top-button" aria-label="TOP" href="#" role="button"><i class="iconfont icon-arrowup" aria-hidden="true"></i></a><div class="modal fade" id="modalSearch" tabindex="-1" role="dialog" aria-labelledby="ModalLabel" aria-hidden="true"><div class="modal-dialog modal-dialog-scrollable modal-lg" role="document"><div class="modal-content"><div class="modal-header text-center"><h4 class="modal-title w-100 font-weight-bold">搜索</h4><button type="button" id="local-search-close" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button></div><div class="modal-body mx-3"><div class="md-form mb-5"><input type="text" id="local-search-input" class="form-control validate"> <label data-error="x" data-success="v" for="local-search-input">关键词</label></div><div class="list-group" id="local-search-result"></div></div></div></div></div></main><footer><div class="footer-inner"><div class="footer-content"><a href="https://hexo.io" target="_blank" rel="nofollow noopener"><span>Hexo</span></a> <i class="iconfont icon-love"></i> <a href="https://github.com/fluid-dev/hexo-theme-fluid" target="_blank" rel="nofollow noopener"><span>Fluid</span></a><div><span id="timeDate">载入天数...</span> <span id="times">载入时分秒...</span><script src="/js/duration.js"></script></div></div><div class="statistics"><span id="busuanzi_container_site_pv" style="display:none">总访问量 <span id="busuanzi_value_site_pv"></span> 次 </span><span id="busuanzi_container_site_uv" style="display:none">总访客数 <span id="busuanzi_value_site_uv"></span> 人</span></div></div></footer><script src="https://lib.baomitu.com/nprogress/0.2.0/nprogress.min.js"></script><link rel="stylesheet" href="https://lib.baomitu.com/nprogress/0.2.0/nprogress.min.css"><script>NProgress.configure({showSpinner:!1,trickleSpeed:100}),NProgress.start(),window.addEventListener("load",(function(){NProgress.done()}))</script><script src="https://lib.baomitu.com/jquery/3.6.0/jquery.min.js"></script><script src="https://lib.baomitu.com/twitter-bootstrap/4.6.1/js/bootstrap.min.js"></script><script src="/js/events.js"></script><script src="/js/plugins.js"></script><script src="https://lib.baomitu.com/typed.js/2.0.12/typed.min.js"></script><script>!function(t,e){var i=Fluid.plugins.typing,n=e.getElementById("subtitle");n&&i&&i(n.getAttribute("data-typed-text"))}(window,document)</script><script src="/js/img-lazyload.js"></script><script>Fluid.utils.createScript("https://lib.baomitu.com/tocbot/4.18.0/tocbot.min.js",(function(){var t=jQuery("#toc");if(0!==t.length&&window.tocbot){var i=jQuery("#board-ctn").offset().top;window.tocbot.init(Object.assign({tocSelector:"#toc-body",contentSelector:".markdown-body",linkClass:"tocbot-link",activeLinkClass:"tocbot-active-link",listClass:"tocbot-list",isCollapsedClass:"tocbot-is-collapsed",collapsibleClass:"tocbot-is-collapsible",scrollSmooth:!0,includeTitleTags:!0,headingsOffset:-i},CONFIG.toc)),t.find(".toc-list-item").length>0&&t.css("visibility","visible"),Fluid.events.registerRefreshCallback((function(){if("tocbot"in window){tocbot.refresh();var t=jQuery("#toc");if(0===t.length||!tocbot)return;t.find(".toc-list-item").length>0&&t.css("visibility","visible")}}))}}))</script><script src="https://lib.baomitu.com/clipboard.js/2.0.10/clipboard.min.js"></script><script>Fluid.plugins.codeWidget()</script><script>Fluid.utils.createScript("https://lib.baomitu.com/anchor-js/4.3.1/anchor.min.js",(function(){window.anchors.options={placement:CONFIG.anchorjs.placement,visible:CONFIG.anchorjs.visible},CONFIG.anchorjs.icon&&(window.anchors.options.icon=CONFIG.anchorjs.icon);var n=(CONFIG.anchorjs.element||"h1,h2,h3,h4,h5,h6").split(","),o=[];for(var s of n)o.push(".markdown-body > "+s.trim());"left"===CONFIG.anchorjs.placement&&(window.anchors.options.class="anchorjs-link-left"),window.anchors.add(o.join(", ")),Fluid.events.registerRefreshCallback((function(){if("anchors"in window){anchors.removeAll();var n=(CONFIG.anchorjs.element||"h1,h2,h3,h4,h5,h6").split(","),o=[];for(var s of n)o.push(".markdown-body > "+s.trim());"left"===CONFIG.anchorjs.placement&&(anchors.options.class="anchorjs-link-left"),anchors.add(o.join(", "))}}))}))</script><script>Fluid.utils.createScript("https://lib.baomitu.com/fancybox/3.5.7/jquery.fancybox.min.js",(function(){Fluid.plugins.fancyBox()}))</script><script>Fluid.plugins.imageCaption()</script><script src="/js/local-search.js"></script><script defer src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><script src="/js/DynamicLine.js"></script><script src="/js/boot.js"></script><noscript><div class="noscript-warning">博客在允许 JavaScript 运行的环境下浏览效果更佳</div></noscript></body></html>